#!/usr/bin/env ruby

require 'optparse'
require_relative '../lib/database'

options = {}

parser = OptionParser.new do |parser|
  parser.on('-s', '--start TASK', 'Starts a new task and logs the time that it begun')
  parser.on('-w', '--working TASK', 'Sinalizes that you resumed working on an existing task')
  parser.on('-p', '--pause TASK', 'Sinalizes that you paused the work on an existing task and logs the time since the last "--working" punch')
  parser.on('-t', '--total TASK', 'Shows the total time spent on an existing task')
  parser.on('-d', '--delete TASK', 'Deletes an existing task')

  parser.on('-h', '--help', 'Prints this help') do
    puts parser
    exit
  end
end

parser.parse! into: options

if options.empty?
  puts 'You have to give me something!!!'
  exit
end

command = options.first
case command[0]
when :start
  puts DataBase.add_task command[1], Time.now.to_f
when :pause
  puts DataBase.paused_working command[1], Time.now.to_f
when :working
  puts DataBase.resumed_working command[1], Time.now.to_f
when :total
  total_time = DataBase.get_total_time_spent command[1]
  puts Time.at(total_time).utc.strftime('%Hh %Mm')
when :delete
  puts DataBase.delete_task command[1]
else
  puts 'Command not found'
end
